<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="__PUBLIC__take2/style.css"/>
		<script type="text/javascript" src="__PUBLIC__take2/jquery1.42.min.js" ></script>
		<script type="text/javascript" src="__PUBLIC__take2/js.js" ></script>
	</head>
	<body>
		<div class="controller">
			<div class="header">
				<h1>自助排队取号系统</h1>
				<div class="time">
					<p class="tiem1">{$times.tm|date="H:i",###}</p>
					<p class="tiem2">{$times.tm|date="Y年m月d",###} {$times.week}</p>
				</div>
				<div class="return">
					<a href="{:url('index/index')}?devicenum={$times.numbers}"><i></i>后退</a>
					<a href="{:url('index/index')}?devicenum={$times.numbers}" class="index"><i></i>首页</a>
				</div>
			</div>
			<div class="make-cont">
				<h2>请输入您的预约编号</h2>
				<form action="" method="post">
					<div class="input-group">
						<input type="text" id="num-text" autocomplete="off" onclick="getfocus()"/>
						<button type="button" onclick="return  numberyz()">确定</button>
					</div>
					<p style="color: #fff;margin-top: 20px;font-size: 25px;display: none;margin-left: 590px;" id="ero"></p>
				</form>
				<div class="white-num">
					<p>
						<a href="javascript:" class="link-on">1</a>
						<a href="javascript:" class="link-on">2</a>
						<a href="javascript:" class="link-on">3</a>
						<a href="javascript:" class="link-on">4</a>
						<a href="javascript:" class="link-on">5</a>
						<a href="javascript:" class="link-on">6</a>
						<a href="javascript:" class="link-on">7</a>
						<a href="javascript:" class="link-on">8</a>
						<a href="javascript:" class="link-on">9</a>
						<a href="javascript:" class="link-on">0</a>
						<a href="javascript:" style="font-weight: normal;" onclick="tuiGe()">删除</a>
					</p>
					<p>
						<a href="javascript:" class="link-on">Q</a>
						<a href="javascript:" class="link-on">W</a>
						<a href="javascript:" class="link-on">E</a>
						<a href="javascript:" class="link-on">R</a>
						<a href="javascript:" class="link-on">T</a>
						<a href="javascript:" class="link-on">Y</a>
						<a href="javascript:" class="link-on">U</a>
						<a href="javascript:" class="link-on">I</a>
						<a href="javascript:" class="link-on">O</a>
						<a href="javascript:" class="link-on">P</a>
					</p>
					<p>
						<a href="javascript:" class="link-on">A</a>
						<a href="javascript:" class="link-on">S</a>
						<a href="javascript:" class="link-on">D</a>
						<a href="javascript:" class="link-on">F</a>
						<a href="javascript:" class="link-on">G</a>
						<a href="javascript:" class="link-on">H</a>
						<a href="javascript:" class="link-on">J</a>
						<a href="javascript:" class="link-on">K</a>
						<a href="javascript:" class="link-on">L</a>
					</p>
					<p>
						<a href="javascript:" class="link-on">Z</a>
						<a href="javascript:" class="link-on">X</a>
						<a href="javascript:" class="link-on">C</a>
						<a href="javascript:" class="link-on">V</a>
						<a href="javascript:" class="link-on">B</a>
						<a href="javascript:" class="link-on">N</a>
						<a href="javascript:" class="link-on">M</a>
					</p>
				</div>
			</div>
		</div>
		<script>
			var index = 0; 
			window.onload = function(){
				var Link = document.getElementsByClassName('link-on');
				document.getElementById('num-text').focus();
				for (let i = 0;i<Link.length;i++) {
					Link[i].onclick = function(){
						
						var arr = document.getElementById("num-text");
						if(arr.value.length == index){
							arr.value += this.innerText;
							index = arr.value.length;
							setCaretPosition(arr,index);
						}else {
							setCaretPosition(arr,index);
							insertAfterText(arr,this.innerText);
							index++;
						}
						
					}
				}

				
			}
			function getfocus(){
				var arr = document.getElementById("num-text");
				index = getCursortPosition(arr);
				//console.log(index);
			}
			// 获取光标位置
			function getCursortPosition (textDom) {
			    var cursorPos = 0;
			    if (document.selection) {
			        // IE Support
			        textDom.focus ();
			        var selectRange = document.selection.createRange();
			        selectRange.moveStart ('character', -textDom.value.length);
			        cursorPos = selectRange.text.length;
			    }else if (textDom.selectionStart || textDom.selectionStart == '0') {
			        // Firefox support
			        cursorPos = textDom.selectionStart;
			    }
			    return cursorPos;
			}
			
			// 设置光标位置
			function setCaretPosition(textDom, pos){
			    if(textDom.setSelectionRange) {
			        // IE Support
			        textDom.focus();
			        textDom.setSelectionRange(pos, pos);
			    }else if (textDom.createTextRange) {
			        // Firefox support
			        var range = textDom.createTextRange();
			        range.collapse(true);
			        range.moveEnd('character', pos);
			        range.moveStart('character', pos);
			        range.select();
			    }
			}
			function tuiGe() {
				var arr = document.getElementById("num-text");
			    //删除
			    if(index == 0){
			    	//如果光标在做右边的时候
			    	setCaretPosition(arr,index);
			    	return;
			    }else {			    	
				    index = getCursortPosition(arr)-1;
				    var str = arr.value.split("");
				    str.splice(index,1)
				    arr.value = str.join("");
				    setCaretPosition(arr,index);
			    }
			    
			  }
			function numberyz() {
				if($("#num-text").val() == ""){
					$("#num-text").focus();
					$("#ero").text("提醒：请输入预约编号!");
					$("#ero").fadeIn();
					setTimeout(function(){
						$("#ero").fadeOut();
					},1000);
					return false;
				}
				$.ajax({
					url: "{:url('index/selcetbh')}",
					type: 'GET',
					dataType:'json',
					data: {number: $("#num-text").val(), random: Math.random()},
					success: function(data){
						if(data['info'] == 0){
							$("#ero").text("提醒：预约编号已过期或无效!");
							$("#ero").fadeIn();
							setTimeout(function(){
								$("#ero").fadeOut();
							},2000);
						}else{
							window.location.href="{:url('index/businesssuccsee_1')}?b_id="+data.businessid+"&number="+data.number;
						}
					}
				})				
			}

			/**
			* 在光标后插入文本
			* 参数：
			*     textDom  [JavaScript DOM String] 当前对象
			*     value  [String]  要插入的文本
			*/
			function insertAfterText(textDom, value) {
			    var selectRange;
			    if (document.selection) {
			        // IE Support
			        textDom.focus();
			        selectRange = document.selection.createRange();
			        selectRange.text = value;
			        textDom.focus();
			    }else if (textDom.selectionStart || textDom.selectionStart == '0') {
			        // Firefox support
			        var startPos = textDom.selectionStart;
			        var endPos = textDom.selectionEnd;
			        var scrollTop = textDom.scrollTop;
			        textDom.value = textDom.value.substring(0, startPos) + value + textDom.value.substring(endPos, textDom.value.length);
			        textDom.focus();
			        textDom.selectionStart = startPos + value.length;
			        textDom.selectionEnd = startPos + value.length;
			        textDom.scrollTop = scrollTop;
			    }
			    else {
			        textDom.value += value;
			        textDom.focus();
			    }
			}
		</script>
	</body>
</html>
