<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="__PUBLIC__take1/css.css"/>
		<script type="text/javascript" src="__PUBLIC__take1/jquery1.42.min.js" ></script>
		<script type="text/javascript" src="__PUBLIC__take1/js.js" ></script>
	</head>
	<body>
		<div class="controller">
			<div class="header">
				<h1 class="fl">自助排队取号系统</h1>
				<div class="fr time">
					<p class="house tiem1">{$times.tm|date="H:i",###}</p>
					<p class="week tiem2">{$times.tm|date="Y-m-d",###} {$times.week}</p>
				</div>
			</div>
			<div class="bm-cont">
				<h2>请提交您的相关信息</h2>
				<form action="{:url('index/businesssuccsee_1')}" method="get" class="make">
					<input type="hidden" name="s_id" value="{$info.s_id}">
					<input type="hidden" name="b_id" value="{$info.b_id}">
				{if $isnumber.idcardtake == 1}
					<em>*请点击右侧按钮扫描身份证</em>					
					<div class="input-group">
						<input type="text" readonly="readonly" unselectable='on' name="idcard" id="num-text1" autocomplete="off" placeholder="请点击扫描身份证" value="{$info.idcard}">
						<a href="javascript:;" id="goidcord" info="scanIdcard_1.html?s_id={$info.s_id}&b_id={$info.b_id}" type="button">扫描身份证</a>
					</div>
				{/if}
				{if $isnumber.phone == 1}
					<em>*请输入您的手机号码并点击右侧提交按钮提交信息</em>					
					<div class="input-group">
						<input type="text" name="tel" id="num-text2" value="{$info.tel}" autocomplete="off" placeholder="请输入手机号" onclick="getfocus()">
						<button type="submit" onclick="return  numberyz()">确定</button>
					</div>
				{/if}
				{if $isnumber.phone == 0}
					<div class="input-group" style="margin-top: 40px;text-align: center;">
						<button type="submit" onclick="return  numberyz()">确定</button>
					</div>
				{/if}
					<p style="color: #ff552e;margin-top: 15px;font-size: 20px;display: none;" id="ero"></p>
				</form>			
			</div>
			<div class="white-num">
				<p>
					<a href="javascript:;" class="link-on">1</a>
					<a href="javascript:;" class="link-on">2</a>
					<a href="javascript:;" class="link-on">3</a>					
					<a href="javascript:;" class="link-delct" style="font-weight: normal;" id="tuiGe">删除</a>
				</p>
				<p>
					<a href="javascript:;" class="link-on">4</a>
					<a href="javascript:;" class="link-on">5</a>
					<a href="javascript:;" class="link-on">6</a>
					<a href="javascript:;" class="link-on">0</a>
				</p>
				<p>
					<a href="javascript:;" class="link-on">7</a>
					<a href="javascript:;" class="link-on">8</a>
					<a href="javascript:;" class="link-on">9</a>
					<a href="javascript:;" class="link-on">X</a>
				</p>
			</div>
			<div class="goute" style="background: transparent;">
				<a href="{:url('index/index')}?devicenum={$times.numbers}"><i></i><span>首页</span></a>
			</div>
		</div>
		<script>
		 var index = 0; 
		$(document).ready(function(){
			var Link = document.getElementsByClassName('link-on');

			if (document.getElementById('num-text2')) {
				
				document.getElementById('num-text2').focus();
				var elment = document.getElementById('num-text2').id;
				var arr = document.getElementById(elment);
				$("#num-text2").live('focus', function(e){
					e.stopPropagation();
					elment = $(this)[0].id;					
				});
			}
						
			for (var i = 0; i<Link.length; i++) {
				Link[i].onclick = function(){
					// document.getElementById(elment).focus();
					// document.getElementById(elment).value += this.innerText;
					if(arr.value.length == index){
						arr.value += this.innerText;
						index = arr.value.length;
						setCaretPosition(arr,index);
					}else {
						setCaretPosition(arr,index);
						insertAfterText(arr,this.innerText);
						index++;
					}
					
				};

				
			};
			// 删除
			$("#tuiGe").live('click', function(event) {
				event.stopPropagation();
				document.getElementById(elment).focus();
				var arr = document.getElementById(elment);
		   		if(index == 0){
			    	//如果光标在做右边的时候
			    	setCaretPosition(arr,index);
			    	return;
			    }else {			    	
				    index = getCursortPosition(arr)-1;
				    var str = arr.value.split("");
				    str.splice(index,1)
				    arr.value = str.join("");
				    setCaretPosition(arr,index);
			    }
			    arr = null;
			});

			$("#goidcord").live('click', function(event) {
				if (document.getElementById('num-text2')) {
					var tel = $("#num-text2").val();
				}else {
					var tel = "";
				}
				//判断是否点击两次
				if($("#num-text1").val() != ""){
					return false;
				}
				var Gourl = $(this).attr('info');
				window.location.href = Gourl+"&tel="+tel;
			});	

			Link = null;

		});
			function numberyz() {
				var reg = /^1[3|4|5|7|8][0-9]{9}$/; //验证规则
				if (document.getElementById('num-text1')) {
					if($("#num-text1").val() == ""){
						$("#ero").text("提醒：请扫描身份证");
						$("#ero").fadeIn();
						setTimeout(function(){
							$("#ero").fadeOut();
						},3000);
						return false;
					}
				}
				if (document.getElementById('num-text2')) {
					if($("#num-text2").val() == "" || !reg.test($("#num-text2").val())){
						$("#ero").text("提醒：请输入有效手机号");
						$("#num-text2").focus();
						$("#ero").fadeIn();
						setTimeout(function(){
							$("#ero").fadeOut();
						},3000);
						return false;
					}
				}
				elment = null;
				arr = null;				
			};

			function getfocus(){
				var arr = document.getElementById('num-text2');
				index = getCursortPosition(arr);
				//console.log(index);
			}
			// 获取光标位置
			function getCursortPosition (textDom) {
			    var cursorPos = 0;
			    if (document.selection) {
			        // IE Support
			        textDom.focus ();
			        var selectRange = document.selection.createRange();
			        selectRange.moveStart ('character', -textDom.value.length);
			        cursorPos = selectRange.text.length;
			    }else if (textDom.selectionStart || textDom.selectionStart == '0') {
			        // Firefox support
			        cursorPos = textDom.selectionStart;
			    }
			    return cursorPos;
			}
			
			// 设置光标位置
			function setCaretPosition(textDom, pos){
			    if(textDom.setSelectionRange) {
			        // IE Support
			        textDom.focus();
			        textDom.setSelectionRange(pos, pos);
			    }else if (textDom.createTextRange) {
			        // Firefox support
			        var range = textDom.createTextRange();
			        range.collapse(true);
			        range.moveEnd('character', pos);
			        range.moveStart('character', pos);
			        range.select();
			    }
			}

			/**
			* 在光标后插入文本
			* 参数：
			*     textDom  [JavaScript DOM String] 当前对象
			*     value  [String]  要插入的文本
			*/
			function insertAfterText(textDom, value) {
			    var selectRange;
			    if (document.selection) {
			        // IE Support
			        textDom.focus();
			        selectRange = document.selection.createRange();
			        selectRange.text = value;
			        textDom.focus();
			    }else if (textDom.selectionStart || textDom.selectionStart == '0') {
			        // Firefox support
			        var startPos = textDom.selectionStart;
			        var endPos = textDom.selectionEnd;
			        var scrollTop = textDom.scrollTop;
			        textDom.value = textDom.value.substring(0, startPos) + value + textDom.value.substring(endPos, textDom.value.length);
			        textDom.focus();
			        textDom.selectionStart = startPos + value.length;
			        textDom.selectionEnd = startPos + value.length;
			        textDom.scrollTop = scrollTop;
			    }
			    else {
			        textDom.value += value;
			        textDom.focus();
			    }
			}
		</script>
	</body>
</html>
