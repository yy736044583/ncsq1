<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>视频/轮播</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="format-detection" content="telephone=no">

		<link rel="stylesheet" href="__PUBLIC__static/plugins/layui/css/layui.css" media="all" />
		<link rel="stylesheet" href="__PUBLIC__static/plugins/font-awesome/css/font-awesome.min.css">
	</head>
		<script type="text/javascript" src="__PUBLIC__static/plugins/layui/layui.js"></script>
		<script type="text/javascript" src="__PUBLIC__static/js/jquery-3.1.1.min.js"></script>
		<script type="text/javascript" src="__PUBLIC__static/js/plupload.full.min.js"></script>
	<body>
		<div style="margin: 15px;">
			<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
				<legend>添加视频/轮播</legend>
			</fieldset>

			<form class="layui-form" action="{:url('dsnose/add')}" method="post" enctype="multipart/form-data">
				<div class="layui-form-item">
					<label class="layui-form-label">标题</label>
					<div class="layui-input-block">
						<input type="text" name="title" lay-verify="required" autocomplete="off" placeholder="标题" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">视频/轮播</label>
					<div class="layui-input-block">
						<div class="layui-inline radios">
							<input type="radio" name="type" value="2" title="视频">
						</div>
						<div class="layui-inline radios">
							<input type="radio" name="type" value="1" title="轮播" checked="checked">
						</div>
					</div>
				</div>				
				<div class="layui-form-item layui-form-text">	 
					<label class="layui-form-label">图片上传</label>
					<div class="layui-input-block">
						<div class="layui-block file-show" style="display: none;">
								<a href="javascript:;" class="layui-btn layui-btn-primary" id="browse"> <i class="layui-icon">&#xe608;</i>选择视频</a>
								<span id="videoname"></span>
								<div class="layui-progress layui-progress-big" lay-showpercent="true" style="width: 15%; margin-top: 10px;    position: relative;height: 6px;border-radius: 20px;background-color: #e2e2e2;">
							        <div class="layui-progress-bar layui-bg-green" lay-percent="50%" style="width: 0%;position: relative;height: 6px;border-radius: 20px;"></div>
							        <span id="vodeonum" style="position: absolute;right: -40px;top: -5px">0%</span>
							    </div>
						</div>
						<div class="layui-inline file-show">
							<input type="file" name="imge" class="layui-upload-file" id="imges"> 
							<span>图片尺寸建议840*500px</span>
							<div class="layui-form-item">
								<div class="imgs" style="width: 840px;max-height: 500px; overflow: hidden;">
									<img src="" alt="">
								</div>
							</div>
						</div>												
						<input type="hidden" name="url" id="url">
					</div>
				</div>	
				<div class="layui-form-item">
					<div class="layui-input-block">
						<button class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
					</div>
				</div>
			</form>
		</div>
	</body>
<script>
	layui.use(['form', 'layedit', 'laydate'], function() {
		var form = layui.form(),
			layer = layui.layer,
			layedit = layui.layedit,
			laydate = layui.laydate;

			form.verify({
			    required: function(value){
			      if(value.length < 1){
			        return '不能为空';
			      }
			    }
			  });
	});
</script>
<script>
	layui.use('upload', function(){
	  layui.upload({
	    url: "{:url('dsnose/fileupload')}" //上传接口
	    ,elem: '#imges'
	    ,success: function(res){ //上传成功后的回调
	      $(".imgs img").attr('src','/sbxt/public/uploads/dsbanner/'+res);
	      $("#url").val('dsbanner/'+res);
	    }
	  });
	});
	$(document).ready(function(){
		$(".radios").click(function(event) {
			event.stopPropagation();
			var Index = $(this).index();
			$(".file-show").eq(Index).siblings().hide();
			$(".file-show").eq(Index).show();
		});
	})

	//实例化一个plupload上传对象
    var uploader = new plupload.Uploader({
        browse_button : 'browse', //触发文件选择对话框的按钮，为那个元素id
        url : "{:url('dsnose/redioupload')}", //服务器端的上传页面地址
        flash_swf_url : 'js/Moxie.swf', //swf文件，当需要使用swf方式进行上传时需要配置该参数
        silverlight_xap_url : 'js/Moxie.xap', //silverlight文件，当需要使用silverlight方式进行上传时需要配置该参数
        filters: {
			mime_types : [ //只允许上传图片和zip文件
			    { title : "Vodep files", extensions : "mp4" }, 
			],
			  max_file_size : '102400kb', //最大只能上传400kb的文件
			  prevent_duplicates : true //不允许选取重复文件
		},
		file_data_name:"file"
    });    

    //在实例对象上调用init()方法进行初始化
    uploader.init();

    //绑定各种事件，并在事件监听函数中做你想做的事
    uploader.bind('FilesAdded',function(uploader,files){
        for(var i = 0, len = files.length; i<len; i++){
			var file_name = files[i].name; //文件名
			$("#videoname").text(file_name);
			uploader.start()//上传
			//构造html来更新UI
			// var html = '<li id="file-' + files[i].id +'"><p class="file-name">' + file_name + '</p><p class="progress"></p></li>';
			// $(html).appendTo('#file-list');
		}
    });
    uploader.bind('UploadProgress',function(uploader,file){
        //console.log(file.percent);
        $(".layui-bg-green").css("width",file.percent+"%");
        $("#vodeonum").text(file.percent+"%");
    });
    uploader.bind('Error',function(uploader,errObject){
        if(errObject.code == "-600"){
        	alert("您选择的视频太大！请重新选择");
        }
    });
    uploader.bind('FileUploaded',function(uploader,file,responseObject){
        if(responseObject.code=="-200"){
        	alert("上传错误稍后再试");
        	return false;
        }
        
        $("#url").val('dsbanner/'+responseObject.response);        
    });
</script>
</html>